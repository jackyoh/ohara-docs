---
title: Shabondi
linktitle: Shabondi
toc: true
type: docs
date: "2020-06-18T00:00:00+01:00"
draft: false
menu:
  rest-api:
    parent: REST APIs
    weight: 150
oharaVersion: 0.10.0
---

Shabondi service play the role of a http proxy service in the Pipeline.
Just like connector, there have two kinds of Shabondi service:

- Source: **Shabondi source service** receives data from http request
  and then writes the data into the linked topic.
- Sink: Users can use http request to read topic data through
  **Shabondi sink service**

The following are common setting both Shabondi source and sink:

1. name (**string**) --- the value of group is always "default". The
   legal character is number, lowercase alphanumeric characters, or `.`
2. group (**string**) --- the name of this connector. The legal
   character is number, lowercase alphanumeric characters, or `.`
3. brokerClusterKey (**object**) --- the broker cluster used to store
   data generated by this worker cluster
   - brokerClusterKey.group (**option(string)**) --- the group of
     cluster
   - brokerClusterKey.name (**string**) --- the name of cluster

{{% alert note %}}
the following forms are legal as well: (1) `{"name": "n"}`, (2) `"n"`.
Both forms are converted to `{"group": "default", "name": "n"}`
{{% /alert %}}

4. shabondi.class (**string**) --- class name of Shabondi service, only
   the following two class names are legal:
   - Shabondi source: `oharastream.ohara.shabondi.ShabondiSource`
   - Shabondi sink: `oharastream.ohara.shabondi.ShabondiSink`
5. shabondi.client.port (**int**) - The Shabondi service client port
6. imageName (**string**) --- docker image
7. nodeNames **array(string)** - The nodes that running this Shabondi.
   Currently, Shabondi not support multiple nodes deployment. So
   nodeNames only can be contained one node when start shabondi
   service, otherwise you'll get an error.
8. tags (**object**) --- the extra parameter for this object
9. routes (**object**) -
10. jmxPort (**int**) - the JVM jmx port for Shabondi service
11. xms (**int**) - the initial memory allocation pool for JVM
12. xmx (**int**) - the maximum memory allocation pool for JVM
13. author (**string**) ---
14. revision (**string**) ---
15. version (**string**) ---

**Shabondi Source only settings**

1. shabondi.source.toTopics (**array(object)**) - The topic which
   Shabondi source service would write the data to.

**Shabondi Sink only settings**

1. shabondi.sink.fromTopics (**array(object)**) - The topic which
   Shabondi sink service would read the data from.
2. shabondi.sink.group.idletime (**duration**) - The maximum idle
   time of each sink data group.
3. shabondi.sink.poll.timeout(**duration**) - The maximum time of
   each consumer poll.

The following information are updated by Ohara

1. lastModified (**long**) --- the last time to update this
   shabondi service
2. state (**option(string)**) --- the state of a started shabondi
   service
3. aliveNodes (**Set(string)**) --- the nodes hosting this shabondi
   service
4. error (**option(string)**) --- the error message from a failed
   shabondi service. If the a shabondi service is fine or
   un-started, you won't get this field.
5. [nodeMetrics]({{< relref "../custom_connector.md#metrics" >}}) (**object**) --- 
   the metrics from a running connector
   - meters (**array(object)**) --- the metrics in meter type
     - meters[i].name (**string**) --- the number of this meter
       (normally, it is unique)
     - meters[i].value (**double**) --- the value in double
     - meters[i].valueInPerSec (**double**) --- the average
       value in per second
     - meters[i].unit (**string**) --- the unit of value
     - meters[i].document (**string**) --- human-readable
       description to this meter
     - meters[i].queryTime (**Long**) --- the time we query
       this meter from remote nodes
     - meters[i].startTime (**Long**) --- the time to start
       this meter (not all services offer this record)
     - meters[i].lastModified (**Long**) --- the time of
       modifying metrics

## List settings of all Shabondi services {#list-all}

*GET /v0/shabondis*

* Example Response
    ```json
    [
      {
        "author": "root",
        "brokerClusterKey": {
          "group": "group0",
          "name": "bk00"
        },
        "name": "shabondi0",
        "xms": 1024,
        "routes": {},
        "state": "RUNNING",
        "lastModified": 1587100361274,
        "shabondi.client.port": 58456,
        "shabondi.source.toTopics": [
          {
            "group": "group0",
            "name": "topic0"
          }
        ],
        "tags": {},
        "xmx": 1024,
        "shabondi.class": "oharastream.ohara.shabondi.ShabondiSource",
        "nodeMetrics": {
          "node00": {
            "meters": [
              {
                "document": "The number of received rows",
                "lastModified": 1587100347637,
                "name": "total-rows",
                "queryTime": 1587100360577,
                "startTime": 1587100347637,
                "unit": "row",
                "value": 0.0,
                "valueInPerSec": 0.0
              }
            ]
          }
        },
        "imageName": "oharastream/shabondi:{{< param oharaVersion >}}",
        "revision": "7cb25202c5308095546e5a6a2b96480d9d3104e1",
        "version": "{{< param oharaVersion >}}",
        "aliveNodes": [
          "node00"
        ],
        "jmxPort": 56586,
        "kind": "source",
        "group": "group0",
        "nodeNames": [
          "node00"
        ]
      }
    ]
    ```

## Create the settings of a Shabondi service {#create}

*POST /v0/shabondis*

* Example Request
    ```json
    {
      "name": "shabondi0",
      "group": "group0",
      "shabondi.class": "oharastream.ohara.shabondi.ShabondiSource",
      "shabondi.client.port": 58456,
      "shabondi.source.toTopics": [
        {"name": "topic0","group": "group0"}
      ],
      "brokerClusterKey": {
        "group": "group0",
        "name": "bk00"
      },
      "nodeNames": [
        "node00"
      ]
    }
    ```

* Example Response
    ```json
    {
      "author": "root",
      "brokerClusterKey": {
        "group": "group0",
        "name": "bk00"
      },
      "name": "shabondi0",
      "xms": 1024,
      "routes": {},
      "lastModified": 1587101035977,
      "shabondi.client.port": 58456,
      "shabondi.source.toTopics": [
        {
          "group": "group0",
          "name": "topic0"
        }
      ],
      "tags": {},
      "xmx": 1024,
      "shabondi.class": "oharastream.ohara.shabondi.ShabondiSource",
      "nodeMetrics": {},
      "imageName": "oharastream/shabondi:{{< param oharaVersion >}}",
      "revision": "7cb25202c5308095546e5a6a2b96480d9d3104e1",
      "version": "{{< param oharaVersion >}}",
      "aliveNodes": [],
      "jmxPort": 56726,
      "kind": "source",
      "group": "group0",
      "nodeNames": [
        "node00"
      ]
    }
    ```

## Get the settings of a Shabondi service {#get}

*GET /v0/shabondis/${name}?group=${group}*

* Example Response
    ```json
    {
      "author": "vitojeng",
      "brokerClusterKey": {
        "group": "group0",
        "name": "bk00"
      },
      "name": "shabondi0",
      "xms": 1024,
      "routes": {},
      "lastModified": 1587101035977,
      "shabondi.client.port": 58456,
      "shabondi.source.toTopics": [
        {
          "group": "group0",
          "name": "topic0"
        }
      ],
      "tags": {},
      "xmx": 1024,
      "shabondi.class": "oharastream.ohara.shabondi.ShabondiSource",
      "nodeMetrics": {},
      "imageName": "oharastream/shabondi:{{< param oharaVersion >}}",
      "revision": "7cb25202c5308095546e5a6a2b96480d9d3104e1",
      "version": "{{< param oharaVersion >}}",
      "aliveNodes": [],
      "jmxPort": 56726,
      "kind": "source",
      "group": "group0",
      "nodeNames": [
        "node00"
      ]
    }
    ```

## Update the settings of a Shabondi service {#update}

*PUT /v0/shabondis/${name}?group=${group}*

* Example Request
    ```json
    {
      "shabondi.client.port": 96456
    }
    ```

* Example Response
    ```json
    {
      "author": "vitojeng",
      "brokerClusterKey": {
        "group": "group0",
        "name": "bk00"
      },
      "name": "shabondi0",
      "xms": 1024,
      "routes": {},
      "lastModified": 1587106367767,
      "shabondi.client.port": 38400,
      "shabondi.source.toTopics": [
        {
          "group": "group0",
          "name": "topic0"
        }
      ],
      "tags": {},
      "xmx": 1024,
      "shabondi.class": "oharastream.ohara.shabondi.ShabondiSource",
      "nodeMetrics": {},
      "imageName": "oharastream/shabondi:{{< param oharaVersion >}}",
      "revision": "7cb25202c5308095546e5a6a2b96480d9d3104e1",
      "version": "{{< param oharaVersion >}}",
      "aliveNodes": [],
      "jmxPort": 56726,
      "kind": "source",
      "group": "group0",
      "nodeNames": [
        "node00"
      ]
    }
    ```

## Delete the settings of Shabondi {#delete}

*DELETE /v0/shabondis/${name}?group=${group}*

* Example Response
    ```
    202 Accepted
    ```

{{% alert hint %}}
It is ok to delete an nonexistent properties, and the response is
204 NoContent.
{{% /alert %}}

## Start a Shabondi service {#start}

*PUT /v0/shabondis/${name}/start?group=${group}*

* Example Response
    ```
    202 Accepted
    ```

{{% alert hint %}}
You should use [get shabondi]({{< relref "#get" >}}) to fetch up-to-date status
{{% /alert %}}

## Stop a Shabondi service {#stop}

*PUT /v0/shabondis/${name}/stop?group=${group}*

* Example Response
    ```
    202 Accepted
    ```

{{% alert hint %}}
You should use [get shabondi]({{< relref "#get" >}}) to fetch up-to-date status
{{% /alert %}}
